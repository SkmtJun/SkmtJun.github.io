---
title: R157的OSC场景搭建相关笔记
date: 2023-12-11 10:24:47
updated: 2023-12-11 10:24:47
categories:
- 笔记
tags:
- 自动驾驶
- 标准
---
# UN R157——关于自动车道保持系统（ALKS）车辆认证的统一规定

这篇笔记用于记录在对UN-R157文件——即联合国经济及社会理事会（UNCEC）关于自动车道保持系统（ALKS）的法规——建立相关[OSC场景]()时所用到的内容。

目录：
- 关于R157的相关介绍
- 一个可供参考的ALKS的OSC场景的Github仓库

参考：
- [UN-R157文件](https://unece.org/transport/documents/2021/03/standards/un-regulation-no-157-automated-lane-keeping-systems-alks)（后有4版更新）
- [OSC-ALKS-scenarios](https://github.com/asam-oss/OSC-ALKS-scenarios)

<!--more-->
----
# R157解读笔记

这部分不会将每条规定都逐字逐句解读。

注：动态驾驶任务（Dynamic Driving Task，DDT），指对车辆纵向和横向运动的控制与执行

## 5.系统安全与故障安全响应

#### 5.2.5.激活中的系统为了回避碰撞的自动操作

激活的系统应该检测到碰撞风险，尤其是那些和前方或侧方的车辆的，来自前车减速、旁车切入或突然出现的障碍物的风险；也应该自动进行适当的操作，以最大程度减少乘员与其他道路使用者面临的安全风险。

1.激活的系统应（在其最大性能范围内）回避与制动的前车碰撞，除非前车在切入后已经侵入了最小跟车距离（由ALKS根据现车速计算出，见5.2.3.）。

2.激活的系统应回避和正在切入的车辆的碰撞：
1. 只要切入车辆保持其纵向速度低于ALKS车辆
2. 只要可见切入车辆持续了0.72秒以上的横向移动（在抵达下文所述的*跨线碰撞时间TTCLaneIntrusion*参考点前）
3. 当两车头尾距离计算出的*碰撞时间*（两车头尾距离÷相对速度）符合下述计算时：
    - 跨线碰撞时间＞相对速度/(2∙×6m/s^2)+0.35秒
      - 跨线碰撞时间，即为，切入车的前轮外侧边缘，超过车道线0.3米（即参考点）时，计算出的碰撞时间

3.激活的系统应回避和无遮挡的行人的碰撞。

4.已知在前文没有提及的某些其他条件中，ALKS很可能无法完全满足前文要求的回避等操作。然而，系统不得因此停用或更换控制策略。

## 附件3：交通干扰关键场景（性能模型）

关键场景，指ALKS可能无法避免碰撞的情况。

这里使用了2种性能模型来确定场景中的碰撞是否时可以避免的。

### 性能模型1 感知模型

（待补充）

### 性能模型2 

（待补充）

## 附件5：行车测试（track testing）

### 测试场景

下文为对原文**4.测试场景**的精简总结，并适当扩展以提高仿真测试要求。

注：
    ***前车***指**测试车当前车道的前方车辆**；
    ***其他车***指**其他车道上的车辆**；
    ***ALKS车辆***即为**测试本车**；
    ***执行变道（LCM）***是***进行变道（LCP）***的一部分，后者除了实际执行变道操作之外，还有检测目标、开启转向灯等一系列操作。

- 车道保持
    - 要求*ALKS车辆*不离开车道，在系统规定的前进/转弯速度范围内平稳行驶
    - 以下为各类情况细则：
        - 60km/h的速度运行5分钟 或 在足够长的道路上以高于60km/h的速度行驶一段时间
        - 客车/摩托车作为*前车*和*其他车*
        - *前车*在车道中左右偏移
        - *其他车*贴近侧面行驶
- 避免碰撞
    - 要求*ALKS车辆*直到系统规定最大速度为止都不会和各种障碍物相撞
    - 以下为各类情况细则：
        - 使用静止的客车/摩托车/行人/阻塞车道作为*障碍物*
        - 当ALKS车辆速度达到60km/h时，有行人以5km/h的速度横穿道路
        - 一或多种*障碍物*会部分或完全阻塞车道，且数量和种类不定
        - 在弯道等特殊路段
- 跟随前车
    - 要求*ALKS车辆*能保持和恢复与*前车*的安全距离，且能回避与全力减速的*前车*相撞
    - 以下为各类情况细则：
        - 使用速度变化或恒定（真实数据）的客车/摩托车作为*前车*
        - 在直道/弯道等各种路段
        - *前车*在车道中左右偏移
        - *前车*在至少6m/s^2的减速度下直到停止
- 其他车切入
    - 要求*ALKS车辆*能避免与切入当前车道的*其他车*相撞，情况逐渐极端直到达到一个明确的（碰撞的）临界点
    - 切入操作的临界点应由下述内容共同决定：
        - 碰撞时间（Time to Collision/TTC，指两车前后距离除以相对速度的时间）；*切入车*尾端和*本车*前端的纵向距离；*切入车*横向速度；*切入车*纵向运动
        - 细则可见上文5.2.5.节的解读
            - 推测：接近临界点即5.2.5.中的【跨线碰撞时间】从【大于】到逐渐接近【相对速度/(2∙×6m/s^2)+0.35秒】
    - 以下为各类情况细则：
        - 切入时不同的碰撞时间、距离和相对速度值，包括*可避免的*和*不可避免的*碰撞（下文有更详细的参数预设）
        - *切入车*以固定的纵向速度、加/减速度行驶
        - 切入时不同的横向速度、加/减速度
        - 使用客车/摩托车作为*切入车*
    - 推测：似乎使用临界点来测试和使用附录1的是否可避免的加速度来测试是两种不相容的标准，推测应使用后者，而前者仅作为维持ODD的条件。
- 前车切出后的静止障碍物
    - 要求*ALKS车辆*能够在*前车*离开车道后避免与之后的静止障碍物相撞（类似上文“避免碰撞”）
        - 使用静止的客车/摩托车/行人/阻塞车道作为*障碍物*
        - 一或多种*障碍物*会阻塞车道，且数量和种类不定
- 视野测试
    - 要求ALKS能检测到：
        - 前方区域（到其声明的探测范围）中的道路使用者
        - 侧方区域（至少到相邻车道的完整宽度范围）中的车辆
    - 如果ALKS能*进行变道*，则还要求其能以7.1.节（见上文7.1.节的解读）中的各项要求检测到：
        - 前方、侧方和后方的车辆（及其方向指示器状态，如果可以的话）
    - 以下为各个方向探测要求细则：
        - 前方：
            - 接近中的两侧相邻车道外侧边缘的摩托车/（静止的）行人
            - 接近中的本车道内的静止的摩托车/行人
            - （如果能*进行变道*）接近中的从中心线起算的变道方向9米的前方探测范围内的摩托车
        - 侧方：
            - 接近中的两侧相邻车道的摩托车
            - （如果能*进行变道*）接近中的从中心线起算的变道方向9米的侧方探测范围内的摩托车
        - 后方（如果能*进行变道*）：
            - 接近中的从中心线起算的变道方向9米的后方探测范围内的摩托车
    - 关于方向指示器状态检测
        - 如果有该功能，应声明其能检测到其他车方向指示器状态的范围
        - 以下为各类情况细则：
            - 在随机位置被激活的方向指示器
            - 装有方向指示器的不同类型的车辆
- 变道
    - 要求*ALKS车辆*在*进行变道*期间不会对乘员和其他道路使用者造成威胁，并能在开始*执行变道*之前评估周边情况
    - 以下为各类情况细则：
        - 让一些不同种类的车辆（包括摩托车）从后方接近
        - 正常*执行变道*
        - 有车辆从后方接近而不能正常*执行变道*
        - 后方相邻车道有同速车辆而不能变道
        - 相邻车道有车辆而不能变道
        - 在*最小风险策略*期间可以*执行变道*
            - 最小风险策略（Mininum Risk Manoeuvre，MRM），指出现紧急情况，ALKS在等待驾驶员接手控制权期间，自行执行降低风险的措施
        - 让一辆车移动向变道目标位置，迫使ALSK车辆做出反应避免相撞
- 避免因可通行物体产生*紧急策略*
    - 要求*ALKS车辆*不会因为路上有可通行物体（如窨井盖或小树枝）而进行大于5m/s^2的减速的*紧急策略*
        - 紧急策略（Emergency Manoeuvre，EM），指系统为了回避碰撞而自动进行的操作
    - 以下为各类情况细则：
        - 没有*前车*
        - 以客车/摩托车作为*前车*

#### 附录1：测试难度指导

根据附件3的性能模型1，给出了对三种场景（前车切入、前车切出后静止的障碍物、前车制动）困难程度参数设置的参考。

共有三种难度标准：
- 可避免的：制动加速度 ＜ 5 m/s^2
- 困难的：5 m/s^2 ＜ 制动加速度 ＜ 7.2 m/s^2
- 不可避免的：7.2 m/s^2 ＜ 制动加速度

#### 关于“其他车切入”的场景仿真参数预设1

**【已废弃：这套参数并非对不同困难程度的测试，而是对ALKS能否正常工作的测试，可见5.2.5.项的表述。】**

因为“其他车切入”场景对于性能模型测试的参数有一定的指定，在此简单介绍一个OSC参数预设。

已知条件：
1.前车在切入前需进行至少0.72秒的横向移动
2.“不可避免的碰撞”场景意味着7.6m/s^2及以上的制动加速度才能回避掉（此条为验证条件）
3.碰撞时间临界点（下称临界时间）计算公式：相对速度/(2∙×6m/s^2)+0.35秒；当前车前轮外沿过线0.3m（下称参考点）时开始计算碰撞时间，并和临界时间对比，小于临界时间即为“不可避免的碰撞”

分析：
可知本车需要观察到前车经过0.72秒的横移，并抵达参考点时，才会将其判定为正在切入并进行减速回避。
于是进行极端假设，这些假设可以修改以符合泛化要求。

假设条件：
1.相对速度直到前车开始变道为止都是2m/s
2.前车将从自己的车道中央，横向移动耗时0.72秒抵达参考点
3.每条车道宽4米，每条车道线宽0.15米（两者重合），本车宽1.8米，前车宽2米
4.所有车都将瞬间抵达对应加速度，全程速度恒定

推导：
1.由临界时间公式得，临界时间与相对速度直接相关。因此在**相对速度**确定为**2m/s**的情况下，可以直接计算出**临界时间**，其为2/12+0.35=**0.517（秒）**。但这个时间很难被OSC直接使用，所以：
2.在时间和相对速度都确定的情况下，我们可以推出临界时间的两车距离，其为0.517*2=**1.02（米）**。但想利用这一距离依然相对困难，此刻前车正在动态中，并刚好抵达了参考点，所以我们需要模拟出前车切入的全过程：
3.1.前车在0.72秒内从自身车道中心线侧向偏移到了参考点。由假设条件可以推出，这段横向移动距离为：车轮到车道边缘的距离（车道宽的一半-车宽的一半）+车道线宽的一半+0.3米，即0.75+0.075+0.3=**1.125（米）**。而一个完整的变道过程，前车需要横向移动一个车道宽的距离，即**3.5米**。接着推导耗时：
3.2.前车在移动到参考点时刚好耗时**0.72秒**，假设这段横向移动的加速瞬间完成，并保持速度恒定，可以等比推出变道总耗时为**2.24秒**。
4.前车在移动到参考点时，同时因为相对速度，而缩短了和本车的距离。这个距离为0.72*2=**1.44（米）**，将其加入到临界时间的两车距离上，就可以得到前车应该在距离为**2.46米**时开始变道。

至此，我们可以得到所有仿真所需要的数据。

#### 关于“其他车切入”的场景仿真参数预设2

这个参数预设使用了附件3和对应附件5.附录1的参数设计。

## 附件6：公共道路测试（public road testing）

公共道路测试要求ALKS车辆能在实际道路上通过指定测试，并列出了一部分需要进行的测试细则。

以下是需要出现的要素：
- 运行设计域外的情况（要求ALKS不启动）
    - 不合适的高速公路上/城市环境中/不合适的时间天气中
- 不违反交通规则
    - 有速度限制/速度限制在60kms^-1反复变化
    - 接触需要系统反应的指示牌（至少不同的3种）
    - 和前车保持足够的距离
    - 不穿过禁止变道的实线
- 道路情景
    - 隧道/高速公路尽头/作业区/收费站/封闭车道
    - 接近的紧急服务车辆（救护车/警车/消防车等）
    - 环境条件变化
- 对其他道路使用者
    - 前车的加减速
    - 摩托车/重型卡车作为前车
    - 在道路入口/出口与其他车辆合流（自由流动/轻度拥堵/重度拥堵 至少重复10次）
    - ALKS车辆与前车距离不足时，有车辆强行插入
    - 有车切出（例如在高速出口）
    - ALKS车辆以不同的初速度接近停停走走的交通流（至少10种情况）
- 车道保持
    - 不同曲率的弯道
    - 有另一辆车靠近行驶
- 执行变道
    - 向相邻车道（周围有无交通情况）
    - 在高速公路入口合流
    - 在道路出口合流（自由流动/轻度拥堵/重度拥堵 至少重复5次）

----
# OSC-ALKS-scenarios——为R157设计的OSC场景仓库

这是Github上的一个针对R157文件的**附件5**的4.1到4.6节所建的OSC场景文件仓库。其中包括了下述内容：
- 共计15个测试场景，和对应的15个变体场景（xosc文件）
    - 这些场景使用的6个测试场地（xodr文件）
- 提供给[esmini]()和openPASS的可视化脚本

注意：该仓库使用**OSC1.1**和**ODR1.7**来构建场景。

## OSC场景列表

可以对照上文附件5中的要求查看。

- 4.1_1 自由行驶
- 4.1_2 前车左右偏移
- 4.1_3 临车贴近行驶
- 4.2_1 车道被障碍物全部占据
- 4.2_2 车道被障碍物部分占据
- 4.2_3 行人横穿
- 4.2_4 车道被多种障碍物占据
- 4.3_1 跟随前车（无状况）
- 4.3_2 跟随前车（紧急刹车）
- 4.4_1 无碰撞切入
- 4.4_2 不可避免碰撞切入
- 4.5_1 车道被障碍物全部占据时前车切出
- 4.5_2 车道被多种障碍物占据时前车切出
- 4.6_1 前方探测范围
- 4.6_2 侧方探测范围

